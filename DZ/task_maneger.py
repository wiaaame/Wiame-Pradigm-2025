#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Персональный менеджер задач (To-Do List Manager)
Автор: [Ваше ФИО]
Язып: Python 3
"""

import json  # Модуль для работы с JSON форматом (сохранение/загрузка данных)
import os    # Модуль для взаимодействия с операционной системой (проверка файлов)

# Имя файла для хранения задач
FILE_NAME = "tasks.txt"

def load_tasks():
    """
    Функция для загрузки списка задач из файла.
    Использует парадигму структурного программирования.

    Возвращает:
        list: Список словарей, каждый из которых представляет одну задачу.
              Если файл не существует или пуст, возвращает пустой список.
    """
    # Проверяем, существует ли файл
    if not os.path.exists(FILE_NAME):
        return []  # Возвращаем пустой список, если файла нет

    try:
        # Открываем файл для чтения ('r' - read)
        with open(FILE_NAME, 'r', encoding='utf-8') as file:
            # Загружаем данные из JSON формата в объект Python
            tasks = json.load(file)
            # Убеждаемся, что это список
            if isinstance(tasks, list):
                return tasks
            else:
                return []
    except (json.JSONDecodeError, FileNotFoundError):
        # Если файл поврежден или пуст, возвращаем пустой список
        return []

def save_tasks(tasks):
    """
    Функция для сохранения списка задач в файл.

    Аргументы:
        tasks (list): Список задач для сохранения.
    """
    # Открываем файл для записи ('w' - write). Файл будет создан, если его нет.
    with open(FILE_NAME, 'w', encoding='utf-8') as file:
        # Преобразуем список задач в JSON строку с отступами (indent=4) для читаемости
        json.dump(tasks, file, ensure_ascii=False, indent=4)

def display_tasks(tasks):
    """
    Функция для отображения всех задач в консоли.

    Аргументы:
        tasks (list): Список задач для отображения.
    """
    if not tasks:  # Если список пуст
        print("\n--- Список задач пуст. Добавьте первую задачу! ---")
        return

    print("\n" + "="*40)
    print("МОЙ СПИСОК ЗАДАЧ".center(40))
    print("="*40)

    # Используем цикл for для итерации по списку задач.
    # Функция enumerate() возвращает индекс и элемент списка.
    for index, task in enumerate(tasks, start=1):
        # Тернарный оператор для выбора статуса задачи
        status = "✓" if task['completed'] else "✗"
        print(f"{index}. [{status}] {task['title']}")
    print("="*40)

def add_task(tasks):
    """
    Функция для добавления новой задачи.
    Демонстрирует работу с вводом пользователя и модификацией списка.

    Аргументы:
        tasks (list): Список задач, который будет изменен.
    """
    print("\n--- Добавление новой задачи ---")
    # Получаем описание задачи от пользователя
    title = input("Введите описание задачи: ").strip()

    if title:  # Проверяем, что строка не пустая
        # Создаем словарь, представляющий задачу
        new_task = {
            'title': title,
            'completed': False  # Новая задача по умолчанию не выполнена
        }
        # Добавляем задачу в конец списка (метод append)
        tasks.append(new_task)
        save_tasks(tasks)  # Сохраняем изменения в файл
        print(f"Задача '{title}' успешно добавлена!")
    else:
        print("Ошибка: описание задачи не может быть пустым.")

def complete_task(tasks):
    """
    Функция для отметки задачи как выполненной.
    Демонстрирует доступ к элементам списка по индексу и изменение словаря.

    Аргументы:
        tasks (list): Список задач.
    """
    if not tasks:
        print("Список задач пуст. Нечего отмечать как выполненное.")
        return

    display_tasks(tasks)
    try:
        # Получаем номер задачи от пользователя (преобразуем строку в число)
        task_num = int(input("\nВведите номер задачи для отметки как выполненной: "))

        # Проверяем, что номер находится в допустимом диапазоне
        if 1 <= task_num <= len(tasks):
            # Индексы в Python начинаются с 0, поэтому вычитаем 1
            tasks[task_num - 1]['completed'] = True
            save_tasks(tasks)  # Сохраняем изменения
            print(f"Задача №{task_num} отмечена как выполненная!")
        else:
            print(f"Ошибка: введите номер от 1 до {len(tasks)}.")
    except ValueError:  # Обработка исключения, если введено не число
        print("Ошибка: пожалуйста, введите корректный номер.")

def delete_task(tasks):
    """
    Функция для удаления задачи из списка.
    Демонстрирует удаление элемента списка по индексу.

    Аргументы:
        tasks (list): Список задач, который будет изменен.
    """
    if not tasks:
        print("Список задач пуст. Нечего удалять.")
        return

    display_tasks(tasks)
    try:
        task_num = int(input("\nВведите номер задачи для удаления: "))

        if 1 <= task_num <= len(tasks):
            # Метод pop() удаляет элемент по индексу и возвращает его
            removed_task = tasks.pop(task_num - 1)
            save_tasks(tasks)  # Сохраняем изменения
            print(f"Задача '{removed_task['title']}' удалена.")
        else:
            print(f"Ошибка: введите номер от 1 до {len(tasks)}.")
    except ValueError:
        print("Ошибка: пожалуйста, введите корректный номер.")

def main():
    """
    Главная функция программы. Реализует основной цикл меню.
    Демонстрирует использование условных операторов и циклов в Python.
    """
    # Загружаем задачи при запуске программы
    tasks = load_tasks()

    # Бесконечный цикл для отображения меню
    while True:
        print("\n" + "-"*40)
        print("ПЕРСОНАЛЬНЫЙ МЕНЕДЖЕР ЗАДАЧ".center(40))
        print("-"*40)
        print("1. Показать все задачи")
        print("2. Добавить новую задачу")
        print("3. Отметить задачу как выполненную")
        print("4. Удалить задачу")
        print("5. Выйти")
        print("-"*40)

        # Получаем выбор пользователя
        choice = input("Выберите действие (1-5): ").strip()

        # Условный оператор для выбора функции
        if choice == '1':
            display_tasks(tasks)
        elif choice == '2':
            add_task(tasks)
        elif choice == '3':
            complete_task(tasks)
        elif choice == '4':
            delete_task(tasks)
        elif choice == '5':
            print("\nСпасибо за использование менеджера задач. До свидания!")
            break  # Выход из цикла и завершение программы
        else:
            print("Ошибка: пожалуйста, выберите число от 1 до 5.")

# Стандартная конструкция для точки входа в программу на Python
if __name__ == "__main__":
    main()
